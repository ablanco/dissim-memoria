% Solución propuesta (diseño)

\chapter*{Solución propuesta} \label{cap3}
\addcontentsline{toc}{chapter}{Solución propuesta}

\pagenumbering{arabic}

\begin{flushright}
\begin{minipage}{7.85cm}
    {\em No podemos resolver los problemas utilizando la misma manera de pensar
    que utilizamos cuando los creamos.} \\ Albert Einstein
\end{minipage}
\end{flushright}

\vspace*{5mm}

\section*{Definición del Escenario de Simulación}

% TODO

\section*{Agentes en la Simulación}

% TODO esquema de agentes

\subsection*{Agente Creador}

La función del agente Creador es la de lanzar la simulación. Esto lo convierte
en un agente un poco particular, pues no tiene un papel activo en la
simulación.

El ciclo de vida de este agente será el siguiente:

\begin{enumerate}
 \item Procesar el {\bf Escenario} de simulación.
 \item Crear los agentes {\bf Entorno}, y esperar a que hayan obtenido datos
estáticos del terreno (tales como la altura o información sobre las calles).
 \item Crear los agentes de {\bf Entrada de Agua} y los agentes {\bf Peatón}.
 \item Crear el agente {\bf Reloj} y comenzar por tanto la simulación.
 \item Quedarse a la espera por si algún agente le solicita datos del
{\bf Escenario} de simulación.
\end{enumerate}

Como se puede comprobar, una vez que el agente Creador ha terminado de lanzar
la simulación adopta un papel pasivo.

\subsection*{Agente Reloj}

La necesidad de un agente que sincronizase la simulación no se hizo patente
hasta bien avanzado el desarrollo del simulador. El motivo se explica en
profundidad en el capítulo 5. % TODO link al capítulo en cuestión

Este agente tiene el objetivo de sincronizar al resto de agentes, y su
funcionamiento es muy sencillo. Dado un periodo de tiempo, definido en el
{\bf Escenario} de simulación, el agente Reloj ha de enviar regularmente un
mensaje al resto de agentes dando lugar a un ciclo de simulación.

Los agentes que reciben estos mensajes, y por lo tanto están sincronizados,
son: agentes {\bf Entorno}, agentes {\bf Entrada de Agua} y agentes {\bf
Peatón}.

\subsection*{Agentes Entorno}

Probablemente el agente con más responsabilidades y trabajo de todo el
simulador. Su misión es manejar la información relativa al terreno de un área
de simulación.

Para asegurar la escalabilidad del sistema ha de ser posible dividir el área a
simular entre varios agentes {\bf Entorno}, de manera que cada {\bf Entorno} se
pueda ejecutar en un núcleo diferente, o incluso en una máquina diferente. Esta
división ha de ser totalmente trasparente para los demás agentes.

Estos agentes se encargan de:

\begin{itemize}
 \item Obtener la elevación del terreno y la información relativa a calles,
puntos de interés, etc.
 \item Mover el agua de la inundación por el entorno.
 \item Recibir el agua que entre en la simulación desde un agente {\bf Entrada
de agua}.
 \item Informar a los agentes {\bf Peatón} de qué es lo que ven a su alrededor
dada su posición.
 \item Informar a los agentes {\bf Actualización} de la evolución de la
simulación.
% TODO más cosas?
\end{itemize}

\subsection*{Agentes Entrada de Agua}

Estos agentes representan una fuente de agua del sistema. Están localizados en
un punto del área de simulación, y con cada {\em tick} del {\bf Reloj} envían
un mensaje con cierta cantidad de agua al agente {\bf Entorno} correspondiente.

La cantidad de agua de cada mensaje dependerá del ritmo de entrada de agua en
ese punto, y del ritmo de los {\em ticks} de {\bf Reloj}.

\subsection*{Agentes Peatón}

El objetivo final de toda persona que se ve envuelta un desastre es salvarse a
sí misma y a sus allegados. Ese mismo objetivo es compartido por estos agentes,
pues representan a una o a un grupo de personas.

El ciclo de vida del agente será tal que:

\begin{enumerate}
 \item Solicitar información acerca de lo que le rodea al agente {\bf
Entorno} correspondiente.
 \item Analizar dicha información y escoger una posición a la que moverse.
 \item Informar al agente {\bf Entorno} del movimiento y estado de salud.
 \item En caso de haber alcanzado algún refugio, vuelta al punto 1.
\end{enumerate}

En todo momento el agente deberá tratar, evidentemente, de no perder la vida
ahogado en la inundación.

\subsection*{Agentes Actualización}

Actúan únicamente como receptores de mensajes, su misión consiste en recibir
las actualizaciones de los agentes {\bf Entorno} y pasárselas a otros elementos
del sistema, que son los que las procesarán. Como por ejemplo, los {\bf
generadores de KML}, los {\bf visores bidimensionales} o los {\bf generadores de
estadísticas}.

\section*{Elevación del Terreno}

Para obtener los datos de elevación del terreno hemos de utilizar fuentes de
datos externas. En concreto para los Estados Unidos utilizaremos el servicio
web de la USGS\footnote{United States Geological Survey: http://www.usgs.gov/},
donde proveen información de hasta $ \tfrac{1}{9} $ de segundo de arco de
precisión (aproximadamente 3 metros), gracias a la base de datos
NED\footnote{National Elevation Dataset: http://ned.usgs.gov/}. Este servicio
es gratuito y de libre uso.

El simulador ha de ser totalmente independiente de la fuente de datos de
elevación, de manera que sea sencillo añadir nuevas fuentes de datos para poder
simular en territorios fuera de los Estados Unidos. De esta manera el terreno
sobre el que simular sólo estará limitado por los datos de los que dispongamos.

\section*{Open Street Maps}

Para la información relativa a calles, puntos de interés, etc, recurriremos a
OSM\footnote{Open Street Maps: http://www.openstreetmap.org/}. OSM es un
esfuerzo colaborativo para crear cartografía libre, es gratuito y de libre uso.
La calidad de los mapas en las ciudades más grandes e importantes es muy buena,
aunque en lugares menos poblados decae.

Pero al igual que con los datos de elevación, el simulador ha de ser
independiente de OSM y ha de poder utilizar otras fuentes de datos.

\section*{Generador de KML}

El generador de KML será un cliente de un agente {\bf Actualización}. Esto
significa que por cada generador de KML que esté atendiendo a la simulación
habrá un agente {\bf Actualización}. Será el agente el que mantenga la
comunicación con los agentes {\bf Entorno} que sean necesarios.

El fichero resultante deberá ser, como es natural, correcto conforme al
estándar. Para ello contamos con herramientas de
validación\footnote{Por ejemplo http://www.kmlvalidator.com} con las que
comprobar que nuestros ficheros se ajustan al estándar mantenido por el
OGC\footnote{Open Geospatial Consortium:
http://www.opengeospatial.org/standards/kml}. Es muy importante que se ajusten
al estándar para su correcta visualización en cualquier visor de KML.

\section*{Visor Bidimensional}

\section*{Estadísticas}